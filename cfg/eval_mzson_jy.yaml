# General
seed: 77
exp_name: "stretch3"
# exp_name: "debug"
output_parent_dir: "results/jy"
scene_dataset_config_path: "data/hm3d_annotated_basis.scene_dataset_config.json"
scene_data_path: "data/scene_datasets/hm3d/"
test_data_dir: "data/goat_bench/val_unseen/content/"

concept_graph_config_path: "cfg/concept_graph_default.yaml"

# about detection model
yolo_model_name: yolov8x-world.pt
sam_model_name: sam_l.pt
class_set: scannet200  # use the 200-class set for yolo-world detector

# about snapshots clustering
min_detection: 1

# about agent
agent:
  height: 1.41 ### Stretch3
  radius: 0.17
  step_size: 0.25 
  turn_angle: 30.0
  tilt_angle: 30.0

# camera, image
camera_height: 1.5
camera_tilt_deg: -30
img_width: 1280
img_height: 1280
hfov: 120
# min_depth: 0.5 # Minimum reliable depth from the sensor (in meters)
# max_depth: 5.0 # Maximum reliable depth from the sensor (in meters)


# about goatbench evaluation
success_distance: 1.0  # the distance threshold for a successful navigation
clear_up_memory_every_subtask: false
use_full_obj_list: false

# whether to save visualization (which is slow)
save_visualization: true

# the image size for prompting gpt-4o
prompt_w: 360
prompt_h: 360

# DescriptorExtractor settings
use_chain_descriptors: true
gpt_model: "gpt-4o"
descriptors_per_frontier: 4

# navigation
init_clearance: 0.3
max_step_room_size_ratio: 2
num_scan_views: 6 # The number of views to perform a 360-degree scan at each step.

# about tsdf, depth map, and frontier updates
explored_depth: 1.7
tsdf_grid_size: 0.1
margin_w_ratio: 0.25
margin_h_ratio: 0.6
planner:
  eps: 1
  max_dist_from_cur_phase_1: 1  # when the target object is not found, explore the frontiers with this step length
  max_dist_from_cur_phase_2: 1  # when the target object is found, go to the target object with this step length
  final_observe_distance: 1.5  # in phase 2, find a place that is this far from the target object to observe it
  surrounding_explored_radius: 0.7

  # about frontier selection
  frontier_edge_area_min: 4 
  frontier_edge_area_max: 6
  frontier_area_min: 8
  frontier_area_max: 9
  min_frontier_area: 20  # the frontier should have at least this many pixels
  max_frontier_angle_range_deg: 150  # the angle spanned by the pixels in a frontier should not be larger than this
  region_equal_threshold: 0.80

# about scene graph construction
scene_graph:
  confidence: 0.003
  nms_threshold: 0.1
  iou_threshold: 0.5
  obj_include_dist: 3.5
  target_obj_iou_threshold: 0.6


siglip_backend: "open_clip"

# SigLIP
siglip_model_name: "ViT-B-16-SigLIP-384"
siglip_pretrained: "webli"

# CLIP
# siglip_model_name: "ViT-B-16"
# siglip_pretrained: "laion2b_s34b_b88k"


# Navigation settings
goal_verification_threshold: 0.45
direct_goal_detect_conf: 0.4 # Confidence threshold for direct goal detection using YOLO.
relevant_view_angle_threshold_deg: 30 # The angle threshold to consider a view relevant to a frontier. Should be roughly hfov/2.

# Frontier Evaluation settings
# --- Frontier Selection Weights (v3.2) ---
# Semantic_Score = w_itm_score * ITM_Score + w_vlm_score * VLM_Likelihood
w_itm_score: 1.0 # Weight for the evidence-based score (ITM on descriptors)
w_vlm_score: 0.0 # Weight for the VLM's common-sense likelihood score
use_frontier_grouping: true
# When a frontier group is active, stay with it while scores remain above this.
frontier_group_activation_threshold: 0.5
# Drop the active group if all candidates fall below this score.
frontier_group_drop_threshold: 0.5

# The agent resorts to exploration if all frontier scores are below this threshold.
low_score_threshold: 0.5
# If the score difference between the top two frontiers is less than this,
# exploration score is used as a tie-breaker.
tie_breaking_threshold: 0.05
memory_navigation_threshold: 0.7  # Confidence threshold to activate memory-driven navigation

# --- DEPRECATED ---
# exploitation_threshold: 0.55
# num_initial_frontiers_to_explore: 3
# num_steps_per_initial_frontier: 3

# --- Observation Memory Settings ---
# How different an observation must be to be added to memory
observation_diversity_distance_m: 1.0 # in meters
observation_diversity_angle_deg: 45.0 # hfov / 2
semantic_novelty_threshold: 0.85 # Similarity threshold to consider an observation semantically NOT novel
memory_candidates_k: 1 # Number of top memory candidates to try per subtask